# 测试用例：多模态处理协调测试

## 1. 测试目标

验证贾维斯系统v5的多模态处理协调功能，确保系统能够根据配置自动选择合适的处理方式：
- 如果配置了全模态模型，则优先使用全模态模型处理所有类型的数据（图像、语音、视频）
- 如果配置了阿里视觉模型（如qwen-image-plus、qwen-image-max），则使用阿里视觉模型处理图像
- 如果配置了阿里语音模型（如qwen-voice-enrollment、qwen3-asr-flash-filetrans），则使用阿里语音模型处理语音
- 如果未配置阿里模型，则使用jarvis-edge处理语音和图像

## 2. 测试环境

- **硬件环境**：
  - 主控制设备：Windows 10/11 操作系统
  - 网络环境：有线网络或Wi-Fi

- **软件环境**：
  - Java 17+
  - Go 1.20+
  - Docker Compose
  - PostgreSQL 15+
  - Redis 7+
  - Nacos（服务发现和配置中心）
  - Qdrant（向量数据库）
  - RabbitMQ（消息队列）

## 3. 测试用例

### 3.1 阿里视觉模型测试

#### 测试用例1：启用阿里视觉模型处理图像

**测试目标**：验证系统在启用阿里视觉模型时，能够正确使用阿里模型处理图像

**测试步骤**：
1. 配置jarvis-cognition服务的application.yml，启用阿里视觉模型并配置api_key
2. 启动所有服务（使用docker-compose up）
3. 调用jarvis-cognition服务的processImage接口，上传一张测试图像
4. 验证返回结果中是否包含阿里视觉模型的处理信息

**预期结果**：
- 系统能够正确调用阿里视觉模型处理图像
- 返回结果中包含模型名称（如qwen-image-plus）
- 处理结果准确合理

#### 测试用例2：未启用阿里视觉模型处理图像

**测试目标**：验证系统在未启用阿里视觉模型时，能够使用jarvis-edge处理图像

**测试步骤**：
1. 配置jarvis-cognition服务的application.yml，禁用阿里视觉模型
2. 启动所有服务
3. 调用jarvis-cognition服务的processImage接口，上传一张测试图像
4. 验证返回结果中是否包含jarvis-edge的处理信息

**预期结果**：
- 系统能够正确使用jarvis-edge处理图像
- 返回结果中包含"Processed by jarvis-edge"信息
- 处理结果准确合理

### 3.2 阿里语音模型测试

#### 测试用例3：启用阿里语音模型处理语音

**测试目标**：验证系统在启用阿里语音模型时，能够正确使用阿里模型处理语音

**测试步骤**：
1. 配置jarvis-cognition服务的application.yml，启用阿里语音模型并配置api_key
2. 启动所有服务
3. 调用jarvis-cognition服务的processSpeech接口，上传一段测试语音
4. 验证返回结果中是否包含阿里语音模型的处理信息

**预期结果**：
- 系统能够正确调用阿里语音模型处理语音
- 返回结果中包含模型名称（如qwen3-asr-flash-filetrans）
- 处理结果准确合理

#### 测试用例4：未启用阿里语音模型处理语音

**测试目标**：验证系统在未启用阿里语音模型时，能够使用jarvis-edge处理语音

**测试步骤**：
1. 配置jarvis-cognition服务的application.yml，禁用阿里语音模型
2. 启动所有服务
3. 调用jarvis-cognition服务的processSpeech接口，上传一段测试语音
4. 验证返回结果中是否包含jarvis-edge的处理信息

**预期结果**：
- 系统能够正确使用jarvis-edge处理语音
- 返回结果中包含"Processed by jarvis-edge"信息
- 处理结果准确合理

### 3.3 故障转移测试

#### 测试用例5：阿里模型不可用时的故障转移

**测试目标**：验证系统在阿里模型不可用时，能够自动切换到jarvis-edge处理

**测试步骤**：
1. 配置jarvis-cognition服务的application.yml，启用阿里模型但使用无效的api_key
2. 启动所有服务
3. 调用jarvis-cognition服务的processImage和processSpeech接口
4. 验证系统是否能够自动切换到jarvis-edge处理

**预期结果**：
- 系统能够检测到阿里模型不可用
- 自动切换到jarvis-edge处理
- 处理结果准确合理

### 3.4 全模态模型测试

#### 测试用例6：启用全模态模型处理多模态数据

**测试目标**：验证系统在启用全模态模型时，能够正确使用全模态模型处理所有类型的数据

**测试步骤**：
1. 配置jarvis-cognition服务的application.yml，启用全模态模型并配置api_key、api_url和model
2. 启动所有服务（使用docker-compose up）
3. 调用jarvis-cognition服务的processImage接口，上传一张测试图像
4. 调用jarvis-cognition服务的processSpeech接口，上传一段测试语音
5. 调用jarvis-cognition服务的processVideo接口，上传一段测试视频
6. 验证返回结果中是否包含全模态模型的处理信息

**预期结果**：
- 系统能够正确调用全模态模型处理所有类型的数据
- 返回结果中包含模型名称和"Processed by Full Modal Model"信息
- 处理结果准确合理

#### 测试用例7：未启用全模态模型处理数据

**测试目标**：验证系统在未启用全模态模型时，能够按照优先级使用其他模型处理数据

**测试步骤**：
1. 配置jarvis-cognition服务的application.yml，禁用全模态模型
2. 启动所有服务
3. 调用jarvis-cognition服务的processImage和processSpeech接口
4. 验证系统是否能够按照优先级使用阿里模型或jarvis-edge处理数据

**预期结果**：
- 系统能够正确按照优先级使用阿里模型或jarvis-edge处理数据
- 返回结果中包含相应模型的处理信息
- 处理结果准确合理

### 3.5 性能测试

#### 测试用例8：不同处理方式的性能对比

**测试目标**：对比不同处理方式的性能差异

**测试步骤**：
1. 使用全模态模型处理10张测试图像，记录处理时间
2. 使用阿里视觉模型处理同样的10张测试图像，记录处理时间
3. 使用jarvis-edge处理同样的10张测试图像，记录处理时间
4. 使用全模态模型处理10段测试语音，记录处理时间
5. 使用阿里语音模型处理同样的10段测试语音，记录处理时间
6. 使用jarvis-edge处理同样的10段测试语音，记录处理时间
7. 分析性能差异

**预期结果**：
- 全模态模型处理质量最高，但可能响应时间较长
- 阿里模型处理质量较高，响应时间适中
- jarvis-edge处理响应时间较短，但质量可能略低
- 系统能够根据配置和可用性自动选择合适的处理方式

## 4. 测试状态

- [ ] 未测试
- [ ] 测试中
- [ ] 测试通过
- [ ] 测试失败

## 5. 测试结果

[记录实际测试结果和问题]

## 6. 优化建议

[针对测试中发现的问题提供优化建议]

## 7. 结论

[总结测试结果，评估系统是否符合需求]

---

**测试用例版本**：v1.0
**创建日期**：2026年1月29日
**测试团队**：SkyeAI测试小组